<!DOCTYPE html>
<html>
<head>
    <title>Gate Performance Curves - Detailed Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 { color: #333; }
        .equation {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2em;
        }
        .explanation {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .chart { 
            margin: 30px 0; 
            min-height: 500px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .scenario-box {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .highlight {
            background: yellow;
            padding: 2px 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Understanding Gate Performance Curves</h1>
        
        <div class="equation">
            $$Q = C_d \times b \times a \times \sqrt{2g \times h} \times RF$$
            <p style="font-size: 0.9em; margin-top: 10px;">
            Where: RF = Reduction Factor for submerged flow = \(\sqrt{1 - (h_2/h_1)^2}\)
            </p>
        </div>
        
        <div class="explanation">
            <h3>Why Gate Curves Can Be Linear or Non-Linear</h3>
            <p>The shape of gate performance curves depends on several factors:</p>
            <ul>
                <li><strong>Submergence Ratio (h₂/h₁):</strong> Higher submergence → More linear curves</li>
                <li><strong>Head Variation:</strong> Constant head → Linear; Variable head → Curved</li>
                <li><strong>Flow Regime:</strong> Transitions between free/submerged flow create sharp curves</li>
                <li><strong>Gate Type:</strong> Butterfly valves have inherently non-linear area changes</li>
            </ul>
        </div>
        
        <h2>1. Flow Rate vs Gate Opening - Different Conditions</h2>
        <div id="flowChart" class="chart"></div>
        
        <h2>2. Your Specific Case - Why Nearly Linear?</h2>
        <div class="grid">
            <div class="scenario-box">
                <h3>High Submergence Scenario</h3>
                <p><strong>Upstream:</strong> 221m</p>
                <p><strong>Downstream:</strong> 219m</p>
                <p><strong>Submergence Ratio:</strong> 219/221 = <span class="highlight">99.1%</span></p>
                <p><strong>Reduction Factor:</strong> √(1 - 0.991²) = <span class="highlight">0.134</span></p>
                <p><strong>Result:</strong> Flow is heavily restricted by downstream level, making it proportional mainly to gate opening (a).</p>
            </div>
            <div class="scenario-box">
                <h3>Mathematical Explanation</h3>
                <p>When RF is constant (high submergence):</p>
                <p style="text-align: center; font-size: 1.1em;">Q = <span class="highlight">k × a</span></p>
                <p>Where k = Cd × b × √(2gh) × RF = constant</p>
                <p>This creates a <strong>linear relationship</strong> between Q and a!</p>
            </div>
        </div>
        
        <h2>3. Velocity Profiles</h2>
        <div id="velocityChart" class="chart"></div>
        
        <h2>4. Flow Regime Transitions</h2>
        <div id="regimeChart" class="chart"></div>
        
        <h2>5. Derivative Analysis (dQ/da)</h2>
        <div id="derivativeChart" class="chart"></div>
        
        <script>

            // Flow curves data
            var flowTraces = [];

            flowTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 0.4282141932298601, 0.8564283864597202, 1.2846425796895802, 1.7128567729194404, 2.1410709661493, 2.5692851593791604, 2.9974993526090206, 3.4257135458388808, 3.853927739068741, 4.2821419322986, 4.710356125528461, 5.138570318758321, 5.566784511988182, 5.994998705218041, 6.423212898447901, 6.8514270916777615, 7.279641284907621, 7.707855478137482, 8.136069671367341, 8.5642838645972],
                name: 'High Submergence (Your Case)',
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#FF6B6B', 
                    width: 3,
                    shape: 'spline'
                },
                marker: { size: 6 }
            });

            flowTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 0.4282141932298601, 0.8564283864597202, 1.2846425796895802, 1.7128567729194404, 2.1410709661493, 2.5692851593791604, 2.9974993526090206, 3.4257135458388808, 3.853927739068741, 4.2821419322986, 4.710356125528461, 5.138570318758321, 5.566784511988182, 5.994998705218041, 6.423212898447901, 6.8514270916777615, 7.279641284907621, 7.707855478137482, 8.136069671367341, 8.5642838645972],
                name: 'Moderate Submergence',
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#4ECDC4', 
                    width: 3,
                    shape: 'spline'
                },
                marker: { size: 6 }
            });

            flowTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 0.4282141932298601, 0.8564283864597202, 1.2846425796895802, 1.7128567729194404, 2.1410709661493, 2.5692851593791604, 2.9974993526090206, 3.4257135458388808, 3.853927739068741, 4.2821419322986, 4.710356125528461, 5.138570318758321, 5.566784511988182, 5.994998705218041, 6.423212898447901, 6.8514270916777615, 7.279641284907621, 7.707855478137482, 8.136069671367341, 8.5642838645972],
                name: 'Low Submergence',
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#45B7D1', 
                    width: 3,
                    shape: 'spline'
                },
                marker: { size: 6 }
            });

            flowTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 0.4282141932298601, 0.8564283864597202, 1.2846425796895802, 1.7128567729194404, 2.1410709661493, 2.5692851593791604, 2.9974993526090206, 3.4257135458388808, 3.853927739068741, 4.2821419322986, 4.710356125528461, 5.138570318758321, 5.566784511988182, 5.994998705218041, 6.423212898447901, 6.8514270916777615, 7.279641284907621, 7.707855478137482, 8.136069671367341, 8.5642838645972],
                name: 'Free Flow',
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#96CEB4', 
                    width: 3,
                    shape: 'spline'
                },
                marker: { size: 6 }
            });

            flowTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 0.4264262347184295, 0.8492614957214869, 1.2684829102564679, 1.684067213737268, 2.095990739165416, 2.5042294061638377, 2.908758709605547, 3.3095537078183885, 3.7065890103458012, 4.099838765242787, 4.489276645884498, 4.874875837264113, 5.256609021755014, 5.634448364310686, 6.008365497074813, 6.378331503371325, 6.744316901043376, 7.10629162510772, 7.464225009688831, 7.818085769195679],
                name: 'Variable Head',
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#FECA57', 
                    width: 3,
                    shape: 'spline'
                },
                marker: { size: 6 }
            });

            var flowLayout = {
                title: 'Gate Flow Curves Under Different Conditions',
                xaxis: { 
                    title: 'Gate Opening (%)',
                    gridcolor: '#eee'
                },
                yaxis: { 
                    title: 'Flow Rate (m³/s)',
                    gridcolor: '#eee'
                },
                hovermode: 'x unified',
                plot_bgcolor: '#fafafa',
                annotations: [{
                    x: 50,
                    y: 4.93,
                    text: 'Your case: Nearly linear due to 99% submergence',
                    showarrow: true,
                    arrowhead: 2,
                    ax: -50,
                    ay: -30
                }]
            };
            
            Plotly.newPlot('flowChart', flowTraces, flowLayout);
            
            // Velocity profiles
            var velocityTraces = [];

            velocityTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 2.8547612881990676, 2.8547612881990676, 2.854761288199067, 2.8547612881990676, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.8547612881990667],
                name: 'High Submergence (Your Case)',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#FF6B6B', width: 2 }
            });

            velocityTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 2.8547612881990676, 2.8547612881990676, 2.854761288199067, 2.8547612881990676, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.8547612881990667],
                name: 'Moderate Submergence',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#4ECDC4', width: 2 }
            });

            velocityTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 2.8547612881990676, 2.8547612881990676, 2.854761288199067, 2.8547612881990676, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.8547612881990667],
                name: 'Low Submergence',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#45B7D1', width: 2 }
            });

            velocityTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 2.8547612881990676, 2.8547612881990676, 2.854761288199067, 2.8547612881990676, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.8547612881990667, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.854761288199067, 2.854761288199067, 2.8547612881990676, 2.8547612881990667],
                name: 'Free Flow',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#96CEB4', width: 2 }
            });

            velocityTraces.push({
                x: [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [0.0, 2.84284156478953, 2.8308716524049564, 2.81885091168104, 2.8067786895621136, 2.7946543188872215, 2.78247711795982, 2.770246390100521, 2.7579614231819907, 2.7456214891450377, 2.733225843495191, 2.7207737247784833, 2.708264354035619, 2.6956969342333403, 2.6830706496717553, 2.6703846653665835, 2.657638126404719, 2.6448301572719126, 2.631959861151007, 2.619026319189064, 2.606028589731893],
                name: 'Variable Head',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#FECA57', width: 2 }
            });

            var velocityLayout = {
                title: 'Velocity Through Gate',
                xaxis: { title: 'Gate Opening (%)' },
                yaxis: { title: 'Velocity (m/s)' },
                hovermode: 'x unified'
            };
            
            Plotly.newPlot('velocityChart', velocityTraces, velocityLayout);
            
            // Derivative chart
            var derivativeTraces = [];

            derivativeTraces.push({
                x: [5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [7.136903220497668, 7.136903220497668, 7.136903220497667, 7.13690322049767, 7.136903220497663, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497656],
                name: 'High Submergence (Your Case)',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#FF6B6B', width: 2 }
            });

            derivativeTraces.push({
                x: [5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [7.136903220497668, 7.136903220497668, 7.136903220497667, 7.13690322049767, 7.136903220497663, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497656],
                name: 'Moderate Submergence',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#4ECDC4', width: 2 }
            });

            derivativeTraces.push({
                x: [5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [7.136903220497668, 7.136903220497668, 7.136903220497667, 7.13690322049767, 7.136903220497663, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497656],
                name: 'Low Submergence',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#45B7D1', width: 2 }
            });

            derivativeTraces.push({
                x: [5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [7.136903220497668, 7.136903220497668, 7.136903220497667, 7.13690322049767, 7.136903220497663, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.13690322049767, 7.13690322049767, 7.136903220497656, 7.136903220497685, 7.136903220497656, 7.136903220497656],
                name: 'Free Flow',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#96CEB4', width: 2 }
            });

            derivativeTraces.push({
                x: [5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0],
                y: [7.107103911973825, 7.047254350050957, 6.987023575583017, 6.926405058013337, 6.865392090469133, 6.803977783307029, 6.7421550573618205, 6.6799166368806935, 6.617255042123546, 6.554162581616422, 6.490631344028527, 6.4266531896602554, 6.362219741515007, 6.297322375927876, 6.2319522127354405, 6.166100104941874, 6.099756627867518, 6.03291206773906, 5.965556409685184, 5.897679325114129],
                name: 'Variable Head',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#FECA57', width: 2 }
            });

            var derivativeLayout = {
                title: 'Rate of Flow Change (dQ/da) - Linearity Indicator',
                xaxis: { title: 'Gate Opening (%)' },
                yaxis: { title: 'dQ/da (m²/s)' },
                hovermode: 'x unified',
                annotations: [{
                    x: 50,
                    y: 8,
                    text: 'Constant dQ/da = Linear curve',
                    showarrow: false,
                    font: { size: 14, color: 'red' }
                }]
            };
            
            Plotly.newPlot('derivativeChart', derivativeTraces, derivativeLayout);
        </script>
        
        <div class="explanation" style="margin-top: 30px;">
            <h3>Key Insights from Analysis</h3>
            <ol>
                <li><strong>Your Case (Red Line):</strong> Nearly linear because submergence ratio is 99.1%, making the reduction factor nearly constant.</li>
                <li><strong>Free Flow (Green Line):</strong> Shows typical square root relationship - more curved.</li>
                <li><strong>Variable Head (Yellow):</strong> Most realistic - head decreases as flow increases, creating additional curvature.</li>
                <li><strong>Constant dQ/da:</strong> In the derivative chart, a horizontal line indicates linear Q vs a relationship.</li>
            </ol>
        </div>
        
        <div class="equation">
            <h3>Why High Submergence Creates Linear Curves</h3>
            <p>When h₂/h₁ → 1 (high submergence):</p>
            <p>$$RF = \sqrt{1 - (h_2/h_1)^2} \approx \text{constant}$$</p>
            <p>Therefore: $$Q = \underbrace{C_d \times b \times \sqrt{2gh} \times RF}_{\text{constant}} \times a$$</p>
            <p>Result: <strong>Q ∝ a</strong> (Linear relationship)</p>
        </div>
    </div>
</body>
</html>
